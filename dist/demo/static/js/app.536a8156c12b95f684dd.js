webpackJsonp([1],{"3FvV":function(t,e){},gpsz:function(t,e){},iXgl:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),i=n("woOf"),o=n.n(i);var s=function(t,e,n){var a,i,s,l,r,d={top:0,right:0,bottom:0,left:0};return i=e,"[object Object]"===Object.prototype.toString.call(i)?(n=e,e=null):n||(n={}),o()(d,n),(a=e?e.getBoundingClientRect():{top:0,right:window.innerWidth||document.documentElement.clientWidth,bottom:window.innerHeight||document.documentElement.clientHeight,left:0}).top-=d.top,a.right+=d.right,a.bottom+=d.bottom,a.left-=d.left,s=t.getBoundingClientRect(),l=a,(r={}).top=Math.max(s.top,l.top),r.bottom=Math.min(s.bottom,l.bottom),r.left=Math.max(s.left,l.left),r.right=Math.min(s.right,l.right),r.bottom>=r.top&&r.right>=r.left};var l={name:"vue-lazy-waterfall",data:function(){return{maxHeight:0,isFinished:!1,beginIndex:0,showItems:[]}},props:{items:Array,colNum:{type:Number,default:5},width:{type:Number,default:function(){return window.innerWidth}},itemWidth:{type:Number,default:function(){return parseInt(this.width/this.colNum)}},load:Function,createLazyLoader:Function,diff:{type:Object,default:function(){return{bottom:window.innerHeight||document.documentElement.clientHeight}}}},watch:{items:function(){this.render()}},mounted:function(){this.render(),this.$on("preloaded",this.preloadedHandler),this.createLazyloadCallback()},beforeDestroy:function(){this.unbindEvents()},methods:{render:function(){this.isFinished||this.calcItemsStyle()},scrollHandler:function(){!this.isFinished&&s(this.$refs.loadRef,this.diff)&&this.$emit("load")},createLazyloadCallback:function(){var t,e,n;this.createLazyLoader?this.createLazyLoader(this.$refs.loadRef):(this.lazyScrollHandler=(t=this.scrollHandler,e=(e=50)||50,function(){var a=+new Date;(!n||a-n>=e)&&(n=a,t())}),window.addEventListener("scroll",this.lazyScrollHandler.bind(this)))},preloadedHandler:function(t){for(var e=this.colNum,n=0;n<t.length;++n){var a=t[n];a._index>=e&&this.updateItemStyle(a)}!this.isFinished&&this.lazyScrollHandler&&this.lazyScrollHandler()},unbindEvents:function(){this.lazyScrollHandler&&window.removeEventListener("scroll",this.lazyScrollHandler)},end:function(){this.isFinished=!0,this.unbindEvents()},calcItemsStyle:function(){for(var t=this,e=t.beginIndex,n=t.items,a=n.length-e,i=[],o=function(e){return function(n){n&&(e.$event=n,t.$emit("image-"+n.type,e)),0===(a-=1)&&(t.$nextTick(function(){t.$emit("preloaded",i)}),t.$emit("done",i))}},s=e;s<n.length;s++){var l=n[s],r=new Image;l._index=s,l.src?(r.onload=o(l),r.onerror=o(l),r.src=l.src):o(l),t.calcItemStyle(l,s),i.push(l),this.showItems.push(l)}t.beginIndex=t.items.length},updateItemStyle:function(t,e){var n=(e=void 0===e?t._index:e)-this.colNum;if(n>=0){var a=this.$refs["$el_"+n][0],i=this.$refs["$el_"+e][0],o=parseInt(a.style.top)+a.offsetHeight;t._style.top=o+"px",i.style.top=o+"px",this.maxHeight=Math.max(this.maxHeight,o+i.offsetHeight)}},calcItemStyle:function(t,e){var n=e%this.colNum*this.itemWidth;t._style={width:this.itemWidth+"px",left:n+"px",top:"0px"}},clickItemHandler:function(t,e,n){this.$emit("click",{value:t,index:e,$event:n})}}},r={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-lazy-waterfall-wrap",style:{width:t.width+"px"}},[n("ul",{ref:"listRef",staticClass:"vue-lazy-waterfall-list",style:{"padding-top":t.maxHeight+"px"}},[t._l(t.showItems,function(e,a){return n("li",{key:a,ref:"$el_"+a,refInFor:!0,staticClass:"vue-lazy-waterfall-item",style:e._style,on:{click:function(n){t.clickItemHandler(e,a,n)}}},[t._t("default",null,{item:e})],2)}),t._v(" "),n("li",{directives:[{name:"show",rawName:"v-show",value:!1===t.isFinished,expression:"isFinished===false"}],ref:"loadRef",staticClass:"loading-placeholder"},[t._t("loading")],2)],2),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isFinished,expression:"isFinished"}],staticClass:"vue-lazy-waterfall-end"},[t._t("endToBottom",[t._v(t._s(t.isFinished))])],2)])},staticRenderFns:[]};var d=n("VU/8")(l,r,!1,function(t){n("3FvV")},"data-v-6b51780b",null).exports,c=n("mtWM"),u=n.n(c),h={name:"app",data:function(){return{}},components:{vueLazyWaterfall:d},methods:{backToTopHandler:function(){window.scrollTo(0,0)}}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-view"),this._v(" "),e("div",{staticClass:"back-top",on:{click:this.backToTopHandler}},[this._v("back to top")]),this._v(" "),e("div",{staticStyle:{height:"3000px","background-color":"#00C075"}})],1)},staticRenderFns:[]};var m=n("VU/8")(h,f,!1,function(t){n("gpsz")},null,null).exports,p=n("/ocq"),v={name:"app",data:function(){return{items:[],group:0,width:990}},components:{vueLazyWaterfall:d},methods:{loadData:function(){var t=this;u.a.get("./static/mock/data.json?group="+this.group).then(function(e){t.group++,t.group>20?t.$refs.waterfall.end():(e.data.sort(function(){return Math.random()-.5}),t.items=t.items.concat(e.data))})},clickFn:function(t){t.value,t.index,t.$event},imageLoad:function(t){t.$event}},created:function(){this.loadData()}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vueLazyWaterfall",{ref:"waterfall",staticClass:"waterfall-wrap",attrs:{items:t.items,width:t.width,diff:{bottom:2e3}},on:{load:t.loadData,"image-load":t.imageLoad,"image-error":t.imageLoad,click:t.clickFn},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item;return n("div",{staticClass:"pin-item"},[n("img",{attrs:{src:a.src,alt:""}}),t._v("\n      "+t._s(a.textContent)+"\n    ")])}}])},[n("div",{staticClass:"loading-spinner",attrs:{slot:"loading"},slot:"loading"}),t._v(" "),n("div",{staticClass:"end-tip",attrs:{slot:"endToBottom"},slot:"endToBottom"},[t._v("end...")])])],1)},staticRenderFns:[]};var w=n("VU/8")(v,g,!1,function(t){n("iehk")},null,null).exports,y=n("//Fk"),_=n.n(y),b=n("JMHm"),x=n.n(b),z={name:"waterfall-lazy-app",data:function(){return{items:[],page:0}},components:{vueLazyWaterfall:d},methods:{loadData:function(){var t=this;return this.mockPageData().then(function(e){t.items=t.items.concat(e),t.page++,20===t.page&&t.$refs.waterfall.end()})},mockPageData:function(){for(var t=[],e=0;e<20;e++){var n=parseInt(100*Math.random())+300,a=parseInt(100*Math.random())+300;t.push({src:"https://picsum.photos/"+n+"/"+a+"/?random",info:+new Date})}return _.a.resolve(t)},createLazyLoader:function(t){var e=this,n=x()(t,{load:function(){e.loadData()},loaded:function(){e.$refs.waterfall.$on("preloaded",function(){console.log("load next"),t.dataset.loaded=!1,n.observe(t)})},rootMargin:"500px",threshold:1});n.observe()}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrap"},[n("vueLazyWaterfall",{ref:"waterfall",attrs:{items:t.items,width:1190,createLazyLoader:t.createLazyLoader},on:{load:t.loadData},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item;return[n("div",{staticClass:"pin-item"},[n("img",{attrs:{src:a.src,alt:""}}),t._v(" "),n("p",[t._v(t._s(a.info))])])]}}])},[n("div",{staticClass:"loading-spinner",attrs:{slot:"loading"},slot:"loading"}),t._v(" "),n("template",{slot:"endToBottom"},[n("div",{staticClass:"end-tip"},[t._v("it is end...")])])],2)],1)},staticRenderFns:[]};var $=n("VU/8")(z,k,!1,function(t){n("v59T")},null,null).exports;a.a.use(p.a);var H=new p.a({routes:[{path:"/",component:w},{path:"/lazy",component:$}]});new a.a({el:"#app",router:H,template:"<App/>",components:{App:m}})},iehk:function(t,e){},v59T:function(t,e){}},["iXgl"]);
//# sourceMappingURL=app.536a8156c12b95f684dd.js.map